function [ H ] = lucas_kanade(image1,image2)
img1=rgb2gray(image1);
img2=rbg2gray(image2);
img1=im2double(img1);
img2=im2double(img2);

%%Divide input images on non-overlapping regions, each region being 15 Ã— 15.   
[height,width]=size(img1);
region_size = 15; 
numRow = floor(height/region_size);
numCol = floor(width/region_size);
img1=imresize(img1,[numRow*region_size,numCol*region_size]);
img2=imresize(img2,[numRow*region_size,numCol*region_size]);

t1 = (0:numRow-1)*region_size + 1; 
t2 = (1:numRow)*region_size;
t3 = (0:numCol-1)*region_size + 1; 
t4 = (1:numCol)*region_size;

k = 0;
for i = 1 : numRow
    for j = 1 : numCol
        k = k + 1;
        img1_sub = img1(t1(i):t2(i), t3(j):t4(j), :);
        img2_sub = img2(t1(i):t2(i), t3(j):t4(j), :);
        [Ix,Iy]=gradient(img1_sub);
        Ix=reshape(Ix,[region_size*region_size,1]);
        Iy=reshape(Iy,[region_size*region_size,1]);
        A=[Ix Iy];
        It=img1_sub-img2_sub;
        b=reshape(It,[region_size*region_size,1]);
        v=inv(A'*A)*A'*b;
        Vx(i,j)=v(1);
        Vy(i,j)=v(2);
    end
end
figure;
% imshow(img1);
imshow(image1)
hold on
offset=floor(region_size/2);
X=1+offset:region_size:numRow*region_size+offset;
Y=1+offset:region_size:numCol*region_size+offset;
% [X,Y] = meshgrid(1 : numRow ,1 : numCol);
quiver(X,Y,Vx,Vy,'r')
end